<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Favicons -->
    <link
      rel="icon"
      type="image/png"
      href="/assets/favicons/favicon-96x96.png"
      sizes="96x96"
    />
    <link rel="icon" type="image/svg+xml" href="/assets/favicons/favicon.svg" />
    <link rel="shortcut icon" href="/assets/favicons/favicon.ico" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/assets/favicons/apple-touch-icon.png"
    />
    <link rel="manifest" href="/assets/favicons/site.webmanifest" />

    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script>
      if (window.netlifyIdentity) {
        window.netlifyIdentity.on("logout", () => {
          document.location.href = "/admin/";
        });

        window.netlifyIdentity.setLocale("cs");
      }
    </script>

    <title>Spr√°va obsahu</title>
  </head>
  <body>
    <!-- Include the script that builds the page and powers Decap CMS -->
    <script src="https://unpkg.com/decap-cms@^3.8.3/dist/decap-cms.js"></script>
    <script src="preview.js"></script>

    <!-- Documentation: https://decapcms.org/docs/customization/ -->
    <script>
      // Register the styles for the "blog" collection
      CMS.registerPreviewStyle("/admin/decap-preview-styles.css");

      if (window.CMS) {
        // üîÅ Po ulo≈æen√≠ ‚Äì v≈ædy reload seznam
        window.CMS.registerEventListener({
          name: "postSave",
          handler: ({ collection }) => {
            setTimeout(() => {
              const base = window.location.pathname.split("#")[0];
              window.location.href = `${base}#/collections/${collection.get(
                "name"
              )}`;
            }, 300);
          },
        });

        // üß† P≈ôid√°n√≠ vlastn√≠ch tlaƒç√≠tek do editoru
        window.CMS.registerEventListener({
          name: "editor",
          handler: ({ entry, collection }) => {
            if (
              !["poptavky_nove", "poptavky_kontaktovane"].includes(
                collection.get("name")
              )
            ) {
              return;
            }

            // zabr√°n√≠ duplikaci tlaƒç√≠tek
            if (document.querySelector(".custom-status-buttons")) return;

            const container = document.createElement("div");
            container.className = "custom-status-buttons";
            container.style.margin = "1rem 0";
            container.style.display = "flex";
            container.style.gap = "1rem";

            const makeButton = (label, status, color) => {
              const btn = document.createElement("button");
              btn.textContent = label;
              btn.style.padding = "8px 14px";
              btn.style.background = color;
              btn.style.color = "#fff";
              btn.style.border = "none";
              btn.style.borderRadius = "6px";
              btn.style.cursor = "pointer";

              btn.onclick = async () => {
                const updated = entry.get("data").set("status", status);

                await window.CMS.actions.saveEntry({
                  ...entry.toJS(),
                  data: updated.toJS(),
                });
              };

              return btn;
            };

            container.appendChild(
              makeButton(
                "üìû Oznaƒçit jako kontaktov√°no",
                "z√°kazn√≠k kontaktov√°n",
                "#2563eb"
              )
            );
            container.appendChild(
              makeButton("‚úÖ Oznaƒçit jako vy≈ô√≠zen√©", "vy≈ô√≠zeno", "#16a34a")
            );

            const editor = document.querySelector(".nc-entryEditor");
            if (editor) editor.prepend(container);
          },
        });
      }
    </script>
  </body>
</html>
