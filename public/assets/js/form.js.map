{
  "version": 3,
  "sources": ["../../../src/assets/js/form.js"],
  "sourcesContent": ["// -------------------------------\n// FORM 1 \u2013 prvn\u00ED krok\n// -------------------------------\nconst form1 = document.getElementById(\"form-1\");\nconst form2 = document.getElementById(\"form-2\");\n\n// -------------------------------\n// KROK 1 \u2013 odesl\u00E1n\u00ED + redirect\n// -------------------------------\nif (form1) {\n    form1.addEventListener(\"submit\", (e) => {\n        e.preventDefault();\n\n        if (!form1.checkValidity()) {\n            form1.reportValidity();\n            return;\n        }\n\n        const data = Object.fromEntries(new FormData(form1));\n        console.log(data);\n        localStorage.setItem(\"form1\", JSON.stringify(data));\n\n        // okam\u017Eit\u00FD p\u0159echod na krok 2\n        window.location.href = \"/poptavka/\";\n    });\n}\n\n\n// -------------------------------\n// KROK 2 \u2013 na\u010Dten\u00ED a odesl\u00E1n\u00ED\n// -------------------------------\nif (form2) {\n    const waitForData = async (timeout = 5000) => {\n        const start = Date.now();\n        while (Date.now() - start < timeout) {\n            const data = JSON.parse(localStorage.getItem(\"form1\"));\n            if (data) return data;\n            await new Promise(r => setTimeout(r, 100));\n        }\n        return null;\n    };\n\n    (async () => {\n        const data1 = await waitForData();\n\n        if (!data1) {\n            alert(\"Nepoda\u0159ilo se na\u010D\u00EDst data formul\u00E1\u0159e.\");\n            window.location.href = \"/\";\n            return;\n        }\n\n        // Pokud je\u0161t\u011B nem\u00E1me ID, odeslat data\n        if (!data1.id) {\n            try {\n                submitBtn.value = \"Odes\u00EDl\u00E1m...\";\n                const res = await fetch(\"/.netlify/functions/submit\", {\n                    method: \"POST\",\n                    headers: { \"Content-Type\": \"application/json\" },\n                    body: JSON.stringify(data1),\n                });\n\n                if (!res.ok) {\n                    const txt = await res.text();\n                    throw new Error(txt);\n                }\n\n                const json = await res.json();\n                data1.id = json.id;\n\n                // ulo\u017Eit id zp\u011Bt do localStorage\n                localStorage.setItem(\"form1\", JSON.stringify(data1));\n            } catch (err) {\n                console.error(\"Chyba p\u0159i submitu Form 1:\", err);\n                alert(\"Odesl\u00E1n\u00ED se nezda\u0159ilo, zkuste to pros\u00EDm znovu.\");\n            } finally {\n                submitBtn.value = \"Odeslat popt\u00E1vku\";\n            }\n        }\n\n        // napln\u011Bn\u00ED input\u016F daty (a\u0165 u\u017E po submitu, nebo po refreshi)\n        Object.entries(data1).forEach(([key, value]) => {\n            const input = form2.querySelector(`[name=\"${key}\"]`);\n            if (input) input.value = value;\n        });\n    })();\n\n    // p\u0159ep\u00EDn\u00E1n\u00ED dopravy\n    const dopravaRadios = form2.querySelectorAll('input[name=\"doprava\"]');\n    const adresa = form2.querySelector('input[name=\"adresa\"]');\n\n    function updateAdresa() {\n        const selected = form2.querySelector('input[name=\"doprava\"]:checked');\n        if (!selected) return;\n\n        if (selected.value === \"vlastn\u00ED\") {\n            adresa.style.display = \"none\";\n            adresa.required = false;\n            adresa.value = \"\";\n        } else {\n            adresa.style.display = \"\";\n            adresa.required = true;\n        }\n    }\n\n    dopravaRadios.forEach(r => r.addEventListener(\"change\", updateAdresa));\n    updateAdresa();\n\n    // -------------------------------\n    // ODESL\u00C1N\u00CD KONE\u010CN\u00C9HO FORMUL\u00C1\u0158E\n    // -------------------------------\n    form2.addEventListener(\"submit\", async (e) => {\n        e.preventDefault();\n\n        if (form2.dataset.sending === \"true\") return;\n        form2.dataset.sending = \"true\";\n\n        const data = Object.fromEntries(new FormData(form2));\n\n        form2.querySelectorAll(\"input, select, textarea, button\")\n            .forEach(el => el.disabled = true);\n\n        submitBtn.value = \"Odes\u00EDl\u00E1m...\";\n\n        try {\n            const res = await fetch(\"/.netlify/functions/submit\", {\n                method: \"POST\",\n                headers: { \"Content-Type\": \"application/json\" },\n                body: JSON.stringify(data),\n            });\n\n            if (!res.ok) {\n                const txt = await res.text();\n                throw new Error(txt);\n            }\n\n            localStorage.removeItem(\"form1\");\n            window.location.href = \"/poptavka-odeslana/\";\n\n        } catch (err) {\n            console.error(\"Chyba odesl\u00E1n\u00ED:\", err);\n            alert(\"Odesl\u00E1n\u00ED se nezda\u0159ilo. Zkuste to pros\u00EDm znovu.\");\n\n            form2.dataset.sending = \"false\";\n            form2.querySelectorAll(\"input, select, textarea, button\")\n                .forEach(el => el.disabled = false);\n\n            submitBtn.value = \"Odeslat popt\u00E1vku\";\n        }\n    });\n}"],
  "mappings": "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",
  "names": ["updateAdresa"]
}
