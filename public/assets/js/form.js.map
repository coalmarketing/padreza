{
  "version": 3,
  "sources": ["../../../src/assets/js/form.js"],
  "sourcesContent": ["// -------------------------------\n// FORM 1 \u2013 prvn\u00ED krok\n// -------------------------------\nconst form1 = document.getElementById(\"form-1\");\nconst form2 = document.getElementById(\"form-2\");\n\n// -------------------------------\n// KROK 1 \u2013 odesl\u00E1n\u00ED + redirect\n// -------------------------------\nif (form1) {\n    form1.addEventListener(\"submit\", (e) => {\n        e.preventDefault();\n\n        if (!form1.checkValidity()) {\n            form1.reportValidity();\n            return;\n        }\n\n        const data = Object.fromEntries(new FormData(form1));\n\n        console.log(data);\n\n        // odeslat asynchronn\u011B (neblokovat p\u0159esm\u011Brov\u00E1n\u00ED)\n        fetch(\"/.netlify/functions/submit\", {\n            method: \"POST\",\n            headers: { \"Content-Type\": \"application/json\" },\n            body: JSON.stringify(data),\n        })\n            .then(res => res.json())\n            .then(res => {\n                if (res?.id) {\n                    localStorage.setItem(\"form1\", JSON.stringify({\n                        ...data,\n                        id: res.id\n                    }));\n                }\n            })\n            .catch(() => {\n                // tich\u00E1 chyba \u2013 fallback se \u0159e\u0161\u00ED na druh\u00E9 str\u00E1nce\n            });\n\n        // okam\u017Eit\u00FD p\u0159echod na krok 2\n        window.location.href = \"/poptavka/\";\n    });\n}\n\n\n// -------------------------------\n// KROK 2 \u2013 na\u010Dten\u00ED a odesl\u00E1n\u00ED\n// -------------------------------\nif (form2) {\n\n    const waitForData = async (timeout = 5000) => {\n        const start = Date.now();\n        while (Date.now() - start < timeout) {\n            const data = JSON.parse(localStorage.getItem(\"form1\"));\n            if (data?.id) return data;\n            await new Promise(r => setTimeout(r, 100));\n        }\n        return null;\n    };\n\n    (async () => {\n        const data1 = await waitForData();\n\n        if (!data1) {\n            alert(\"Nepoda\u0159ilo se na\u010D\u00EDst data formul\u00E1\u0159e.\");\n            window.location.href = \"/\";\n            return;\n        }\n\n        // napln\u011Bn\u00ED skryt\u00FDch pol\u00ED\n        Object.entries(data1).forEach(([key, value]) => {\n            const input = form2.querySelector(`[name=\"${key}\"]`);\n            if (input) input.value = value;\n        });\n    })();\n\n    // p\u0159ep\u00EDn\u00E1n\u00ED dopravy\n    const dopravaRadios = form2.querySelectorAll('input[name=\"doprava\"]');\n    const adresa = form2.querySelector('input[name=\"adresa\"]');\n    const submitBtn = form2.querySelector('[type=\"submit\"]');\n\n    function updateAdresa() {\n        const selected = form2.querySelector('input[name=\"doprava\"]:checked');\n        if (!selected) return;\n\n        if (selected.value === \"vlastn\u00ED\") {\n            adresa.style.display = \"none\";\n            adresa.required = false;\n            adresa.value = \"\";\n        } else {\n            adresa.style.display = \"\";\n            adresa.required = true;\n        }\n    }\n\n    dopravaRadios.forEach(r => r.addEventListener(\"change\", updateAdresa));\n    updateAdresa();\n\n    // -------------------------------\n    // ODESL\u00C1N\u00CD KONE\u010CN\u00C9HO FORMUL\u00C1\u0158E\n    // -------------------------------\n    form2.addEventListener(\"submit\", async (e) => {\n        e.preventDefault();\n\n        if (form2.dataset.sending === \"true\") return;\n        form2.dataset.sending = \"true\";\n\n        const data = Object.fromEntries(new FormData(form2));\n\n        form2.querySelectorAll(\"input, select, textarea, button\")\n            .forEach(el => el.disabled = true);\n\n        submitBtn.value = \"Odes\u00EDl\u00E1m...\";\n\n        try {\n            const res = await fetch(\"/.netlify/functions/submit\", {\n                method: \"POST\",\n                headers: { \"Content-Type\": \"application/json\" },\n                body: JSON.stringify(data),\n            });\n\n            if (!res.ok) {\n                const txt = await res.text();\n                throw new Error(txt);\n            }\n\n            localStorage.removeItem(\"form1\");\n            window.location.href = \"/poptavka-odeslana/\";\n\n        } catch (err) {\n            console.error(\"Chyba odesl\u00E1n\u00ED:\", err);\n            alert(\"Odesl\u00E1n\u00ED se nezda\u0159ilo. Zkuste to pros\u00EDm znovu.\");\n\n            form2.dataset.sending = \"false\";\n            form2.querySelectorAll(\"input, select, textarea, button\")\n                .forEach(el => el.disabled = false);\n\n            submitBtn.value = \"Odeslat popt\u00E1vku\";\n        }\n    });\n}"],
  "mappings": "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",
  "names": ["updateAdresa"]
}
